openapi: 3.1.0
info:
  title: ProfileBot API
  description: API per gestione embedding e servizi di salute applicativa.
  contact:
    name: ProfileBot Team
    email: team@profilebot.local
  version: 0.1.0
servers:
- url: /
  description: Default
paths:
  /api/v1/embeddings/trigger:
    post:
      tags:
      - embeddings
      summary: Avvia embedding di tutti i CV
      description: Queue a full embedding job.
      operationId: trigger_full_embed_api_v1_embeddings_trigger_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TriggerAllRequest'
        required: true
      responses:
        '202':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskTriggerResponse'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/v1/embeddings/trigger/batch:
    post:
      tags:
      - embeddings
      summary: Avvia embedding batch di CV
      description: Queue a batch embedding job.
      operationId: trigger_batch_embed_api_v1_embeddings_trigger_batch_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TriggerBatchRequest'
        required: true
      responses:
        '202':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskTriggerResponse'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/v1/embeddings/trigger/{res_id}:
    post:
      tags:
      - embeddings
      summary: Avvia embedding singolo CV
      description: Queue a single CV embedding job.
      operationId: trigger_single_embed_api_v1_embeddings_trigger__res_id__post
      parameters:
      - name: res_id
        in: path
        required: true
        schema:
          type: string
          title: Res Id
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TriggerSingleRequest'
      responses:
        '202':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskTriggerResponse'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/v1/embeddings/status/{task_id}:
    get:
      tags:
      - embeddings
      summary: Stato del task di embedding
      description: Return the status of a queued embedding task.
      operationId: get_task_status_api_v1_embeddings_status__task_id__get
      parameters:
      - name: task_id
        in: path
        required: true
        schema:
          type: string
          title: Task Id
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskStatusResponse'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/v1/embeddings/stats:
    get:
      tags:
      - embeddings
      summary: Statistiche della coda di embedding
      description: Return Celery queue stats.
      operationId: get_embedding_stats_api_v1_embeddings_stats_get
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema:
                additionalProperties: true
                type: object
                title: Response Get Embedding Stats Api V1 Embeddings Stats Get
  /health:
    get:
      tags:
      - health
      summary: Health Check
      description: Return application and Qdrant health status.
      operationId: health_check_health_get
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
components:
  schemas:
    EmbeddingItem:
      properties:
        cv_path:
          type: string
          minLength: 1
          title: Cv Path
        res_id:
          type: string
          minLength: 1
          title: Res Id
      type: object
      required:
      - cv_path
      - res_id
      title: EmbeddingItem
      description: Input item for embedding jobs.
    HTTPValidationError:
      properties:
        detail:
          items:
            $ref: '#/components/schemas/ValidationError'
          type: array
          title: Detail
      type: object
      title: HTTPValidationError
    TaskStatusResponse:
      properties:
        task_id:
          type: string
          title: Task Id
        status:
          type: string
          title: Status
        percentage:
          type: integer
          maximum: 100.0
          minimum: 0.0
          title: Percentage
          default: 0
        res_id:
          anyOf:
          - type: string
          - type: 'null'
          title: Res Id
        result:
          anyOf:
          - additionalProperties: true
            type: object
          - type: 'null'
          title: Result
        traceback:
          anyOf:
          - type: string
          - type: 'null'
          title: Traceback
      type: object
      required:
      - task_id
      - status
      title: TaskStatusResponse
      description: Task status response.
    TaskTriggerResponse:
      properties:
        task_id:
          type: string
          title: Task Id
        status:
          type: string
          title: Status
        message:
          anyOf:
          - type: string
          - type: 'null'
          title: Message
      type: object
      required:
      - task_id
      - status
      title: TaskTriggerResponse
      description: Task trigger response.
    TriggerAllRequest:
      properties:
        items:
          items:
            $ref: '#/components/schemas/EmbeddingItem'
          type: array
          minItems: 1
          title: Items
        batch_size:
          type: integer
          minimum: 1.0
          title: Batch Size
          default: 500
        dictionary_path:
          anyOf:
          - type: string
          - type: 'null'
          title: Dictionary Path
        dry_run:
          type: boolean
          title: Dry Run
          default: false
        force:
          type: boolean
          title: Force
          default: false
      type: object
      required:
      - items
      title: TriggerAllRequest
      description: Request payload for full embedding run.
    TriggerBatchRequest:
      properties:
        items:
          items:
            $ref: '#/components/schemas/EmbeddingItem'
          type: array
          minItems: 1
          title: Items
        dictionary_path:
          anyOf:
          - type: string
          - type: 'null'
          title: Dictionary Path
        dry_run:
          type: boolean
          title: Dry Run
          default: false
      type: object
      required:
      - items
      title: TriggerBatchRequest
      description: Request payload for batch CV embedding.
    TriggerSingleRequest:
      properties:
        cv_path:
          type: string
          minLength: 1
          title: Cv Path
        dictionary_path:
          anyOf:
          - type: string
          - type: 'null'
          title: Dictionary Path
        dry_run:
          type: boolean
          title: Dry Run
          default: false
      type: object
      required:
      - cv_path
      title: TriggerSingleRequest
      description: Request payload for single CV embedding.
    ValidationError:
      properties:
        loc:
          items:
            anyOf:
            - type: string
            - type: integer
          type: array
          title: Location
        msg:
          type: string
          title: Message
        type:
          type: string
          title: Error Type
        input:
          title: Input
        ctx:
          type: object
          title: Context
      type: object
      required:
      - loc
      - msg
      - type
      title: ValidationError
tags:
- name: embeddings
  description: Gestione dei job di embedding.
- name: health
  description: Verifiche di stato e disponibilit√†.
